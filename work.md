代码文件只有main.py和index.html
1. 角色与核心指令
你是一位资深的“全栈开发工程师”。
你的任务是接收以下功能需求和修复列表，并对一个现有的 Web 应用程序代码库进行一次性、全面的修改。
执行前置要求：
在编写任何代码之前，请首先完整分析所有需求，并提供一份详细的“实现计划”。该计划应说明你将如何按顺序、分模块地处理以下所有任务，包括将要修改哪些文件（如果可能）、数据结构（如 system_accounts）的变更，以及新 API 的定义。
执行过程要求：
1.	一次性完成：你需要一次性在代码中实现所有变更。
2.	代码质量：确保代码干净、可维护、有适当注释，并遵循现有代码风格。
3.	错误处理：为所有新功能（尤其是 API 调用、表单验证）添加健壮的错误处理逻辑。
4.	逻辑清晰：严格按照需求实现逻辑，特别是权限控制和任务状态部分。
2. 待办任务列表
一、 界面与交互优化 (UI/UX)
1.	guest_warning 告警：
o	修改样式，使其在屏幕上绝对居中显示。
o	添加一个半透明的页面遮罩层（Overlay），以突出显示告警信息。
2.	amap-key-modal (高德地图Key输入框)：
o	实现 API Key 校验逻辑。当用户点击“确认”时：
	校验有效性：调用高德地图 API 验证 Key 是否有效。
	无效处理：若无效，显示明确的错误提示（如“API Key 无效，请检查”），且不关闭 modal。
	有效处理：若有效，保存 Key，关闭 modal，并立即触发地图刷新。
3.	admin-profile-panel_modal (个人资料面板)：
o	美化整体界面。提升视觉美感和用户体验，例如优化布局、字体和控件样式。
4.	admin-health-panel_modal (健康面板)：
o	将当前的“5秒自动刷新”机制，修改为在界面上显示一个明确的“5秒倒计时”计时器。
二、 任务状态与日志
5.	${acc.status_text} 状态显示逻辑重构：
o	当 multi-run-only-incomplete-check 被勾选时：遍历任务列表，必须考虑 multi-param-ignore_task_time 的设置。统计所有“未过期”或“被忽略时间限制”的任务数量 X，显示为“有 X 个任务可执行”。如果 X 为 0，显示“无任务可执行”。
o	当 multi-run-only-incomplete-check 未被勾选时：逻辑同上，但统计的是所有可执行任务（包括已完成但符合运行条件的）。
6.	任务执行日志（无打卡点）：
o	在任务执行期间，如果一个账户的所有任务都因为“没有打卡点”而被跳过：
	${acc.status_text} 状态应显示为“无可执行任务”（而不是“任务全部完成”）。
	在 log-tab (日志标签页) 中，必须明确记录哪些任务因为“无打卡点”而被跳过。
三、 账户、配置与注册
7.	冷启动数据持久化：
o	修复在冷启动时会丢失 amap_js_key 和 Last_User 的 password 的问题。确保这些配置被正确持久化和加载。
8.	system_accounts 文件结构：
o	在 system_accounts 的用户对象结构中，添加 phone 字段，用于存储用户的手机号码。
9.	admin-profile-panel_modal (个人资料)：
o	添加“修改绑定手机号”的功能（包括UI和后端逻辑）。
o	此功能必须可通过 config.ini 配置全局启用或关闭。
10.	auth-login-form (登录表单)：
o	增加“手机号 + 密码”的登录方式。
o	此功能必须可通过 config.ini 配置全局启用或关闭。
11.	auth-register-form (注册表单) 全面升级：
o	手机号验证：注册时 phone 字段为必填项。用户必须通过短信验证码（调用下方任务 VIII 的新 API）验证手机号后方可注册。此功能必须可通过 config.ini 配置全局启用或关闭。
o	昵称：添加“昵称” (Nickname) 输入框，并保存到 system_accounts 中。
o	头像上传：添加“头像上传”功能。如果用户未上传，则显示一个默认头像。
o	一键登录：用户注册成功后，在提示“注册成功！”的同时，提供一个“立即登录”按钮或自动登录机制，允许用户直接进入系统，而无需再次输入用户名和密码。
四、 权限与角色控制
12.	admin-panel-modal (管理面板) 角色隔离：
o	根据用户角色动态显示菜单。当普通用户 (user) 登录时：
	隐藏 admin-groups-list_modal。
	显示 admin-health-panel_modal。
	显示 admin-messages-panel_modal (留言板入口)。
13.	留言板默认权限更新：
o	确保普通用户 (user) 可以 查看自己的留言。
o	确保普通用户 (user) 可以 发表留言。
o	普通用户 (user) 只能 删除自己的留言。
o	管理员 (admin) 可以 删除任何人的留言。
14.	留言板高级权限扩展：
o	实现一套更细粒度的权限配置系统（例如在 admin-users-panel_modal 中）。
o	允许管理员 (admin) 设置特定用户 (user) 的留言板权限，包括：
	是否允许查看留言板。
	是否允许发表留言。
	是“仅查看自己的留言”还是“查看所有留言”。
五、 留言板功能
15.	显示昵称：
o	在 admin-profile-content_modal 中添加“昵称”输入框（对应任务 III.11）。
o	在留言板 (admin-messages-panel_modal) 中，留言时显示用户的“昵称”，而不是 auth_username。
16.	显示头像：
o	在留言板的每条留言旁，显示该用户的头像（对应任务 III.11）。
17.	显示 IP 归属地：
o	在留言板的每条留言旁，显示用户发表留言时的 IP 归属地（例如：“来自：上海”）。
18.	管理员功能：按城市封禁：
o	允许管理员 (admin) 根据 IP 归属地城市，封禁来自某个城市的留言功能。
六、 IP、用户与服务管理 (管理面板)
19.	IP 封禁管理：
o	在 admin-panel-modal 中为管理员添加一个独立的“IP 封禁列表”管理功能。
o	支持：
	添加/删除被封禁的 IP 地址段（如 123.45.6.*）。
	按城市封禁（如封禁所有来自“XX市”的 IP）。
	封禁特定的具体 IP 地址。
	选择封禁范围：是“封禁所有功能”还是“仅封禁特定功能”（如“仅留言板”）。
o	规则：IP 封禁的优先级高于用户封禁。
20.	用户封禁管理：
o	在 admin-panel-modal 中（可结合 admin-users-panel_modal）为管理员添加“用户封禁列表”管理功能，允许添加/删除被封禁的用户。
21.	短信服务管理 ：
o	在 admin-panel-modal 中为管理员添加一个独立的“短信服务配置”面板。
o	允许管理员配置第三方短信 API 的必要参数（如 API Key, Secret 等，用于短信宝）。
o	允许管理员配置一个“短信签名”（例如 【我的应用】），UI上需提示此签名必须符合规范（3-12字）并由服务商审核通过。
o	允许管理员自定义短信发送模板（此为签名之后的内容，例如，“您的验证码是：{code}，5分钟内有效。”）。模板中应支持 {code} 这样的占位符。
o	提供一个“全局禁用短信功能”的开关。如果禁用，则系统中的所有相关功能（如手机注册、手机登录、修改绑定手机）应自动失效。
o	允许管理员设置短信发送的速率限制阈值（例如：XX条/账户/天、XX条/IP/天、XX条/手机号/天）。
o	显示短信接收Webhook URL：在面板中显示一个URL（例如 http://<应用域名>/sms-reply-webhook），并指导管理员将此URL配置到短信宝（SMSBao（https://www.smsbao.com/openapi/213.html））的后台以接收用户回复。
七、 路径与通知
22.	路径录制距离校验：
o	在用户录制路径结束、准备保存时，检查路径总距离。
o	如果距离大于 50km，拒绝保存，并向用户提示“路径过长（>50km），请重新录制”，然后退出录制模式。
23.	通知刷新修复：
o	修复在“账户模式”下，当 attendance-tab (考勤标签页) 处于 active 状态时，出现的无限制、无间隔刷新通知的问题。
o	必须使用 param-auto_attendance_refresh_s 参数作为通知刷新的时间间隔。
八、 API 封装
24.	短信验证码 API (更新)：
o	封装一个新的后端 API，用于发送短信验证码。
o	此 API 需调用第三方短信服务（短信宝：https://www.smsbao.com/openapi/213.html）。
o	API 的配置参数（Key, Secret等）必须从管理员在（任务 VI.21）“短信服务配置”面板中设置的值动态读取。
o	API 在发送时必须将管理员配置的“短信签名”和“短信模板”拼接为一条完整的短信（格式：【签名】+模板内容）后再发送。
o	必须检查（任务 VI.21）中的“全局禁用短信功能”开关。如果已禁用，此 API 应直接返回错误，拒绝发送。
o	必须实现并强制执行管理员设定的速率限制（按账户、IP、手机号）。
25.	短信接收Webhook API (新增)：
o	封装一个新的后端 API (Webhook)，用于接收来自短信宝（SMSBao）的用户回复推送（上行短信）。
o	此 API 必须是一个 GET 端点（例如 /sms-reply-webhook）。
o	它必须能接收 m (手机号) 和 c (短信内容, UTF-8 URL Encoded) 两个查询参数。
o	实现逻辑以处理接收到的短信（例如：解码内容，并将其与用户手机号关联并存储）。
o	在成功接收并初步处理数据后，必须返回纯文本字符串 "0" 以确认接收成功，防止服务商重试。

