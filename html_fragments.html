<!-- ============================================================================
   HTML 片段集合文件 (html_fragments.html)
   ============================================================================
   
   文件说明：
     本文件包含从 index.html 中提取的所有 HTML 片段（大区域、模态框等）
     每个片段用特殊的分隔标记包围，便于后端 API 提取和返回
   
   片段标记格式：
     <!-- 段落开始： fragment-name -->
     ... HTML 内容 ...
     <!-- 段落结束： fragment-name -->
   
   使用方式：
     后端 API 根据 fragment-name 从本文件中提取对应的片段并返回
     前端通过 /html/<fragment-name>.html 动态加载
   
   维护优势：
     - 所有片段集中在一个文件中，便于查找和修改
     - 避免创建大量小文件
     - 便于版本控制和代码审查
   
   更新日期：2025-11-05
   ============================================================================
-->

<!-- 段落开始： multi-account-app -->
<main id="multi-account-app"
    class="hidden h-screen w-screen grid grid-cols-1 lg:grid-cols-[530px,1fr] xl:grid-cols-[530px,1fr] gap-4 p-4">
    <div class="flex flex-col gap-4 h-full min-h-0">
      <div class="panel rounded-xl p-4 flex-shrink-0">
        <div class="flex justify-between items-center mb-3">
          <h2 class="text-lg font-bold text-slate-800 card-title">多账号控制台</h2>
          <div class="flex gap-2">
            <!-- <button id="show-sessions-multi" class="btn btn-ghost !py-1 !px-3" title="会话管理">会话</button> -->
            <button id="show-admin-panel-multi" class="btn btn-ghost !py-1 !px-3" title="管理面板">管理面板</button>
            <button id="exit-multi-mode-btn" class="btn btn-ghost !py-1 !px-3">返回登录页</button>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <button id="multi-start-all-btn" class="btn btn-primary">全部开始</button>
          <button id="multi-stop-all-btn" class="btn btn-danger">全部停止</button>
        </div>
        <div class="mt-4 space-y-2 text-sm border-t pt-3">
          <label class="flex items-center gap-2 cursor-pointer font-semibold text-slate-700">
            <input type="checkbox" id="multi-use-delay-check" checked class="w-4 h-4 accent-sky-600 rounded">
            启用随机启动延迟
            <div class="flex items-center gap-2 pl-6">
              <input type="number" id="multi-min-delay-input" value="0" class="input-field !py-1 w-20 text-center">
              <span>-</span>
              <input type="number" id="multi-max-delay-input" value="300" class="input-field !py-1 w-20 text-center">
              <span>秒</span>
            </div>
          </label>
          <label class="flex items-center gap-2 cursor-pointer font-semibold text-slate-700 mt-2">
            <input type="checkbox" id="multi-run-only-incomplete-check" checked class="w-4 h-4 accent-sky-600 rounded">
            仅执行未完成的任务
          </label>
        </div>
      </div>
      <div class="panel rounded-xl p-4 flex-grow flex flex-col min-h-0">
        <div class="flex justify-between items-center mb-1">
          <div class="flex items-center gap-2">
            <h2 class="text-lg font-bold text-slate-800">账号列表 (<span id="multi-account-count">0</span>)</h2>
            <input type="checkbox" id="multi-select-all-check" class="w-4 h-4 accent-sky-600 rounded" title="全选/取消全选">
          </div>
          <div class="flex gap-2">
            <button id="multi-import-excel-btn" class="btn btn-ghost !py-1 !px-3" title="从文件导入">导入</button>
            <button id="multi-export-excel-btn" class="btn btn-ghost !py-1 !px-3" title="导出汇总">导出</button>
            <button id="multi-download-template-btn" class="btn btn-ghost !py-1 !px-3" title="下载导入模板">下载模板</button>
          </div>

        </div>








        <div class="flex items-center justify-between mb-3 text-xs border-b pb-2">
          <!-- 左侧：刷新 -->
          <div class="flex items-center gap-2">

            <button id="multi-refresh-selected-btn" class="btn btn-ghost !py-0.5 !px-2 text-sm text-blue-600">
              刷新选中
            </button>
            <button id="multi-refresh-all-btn" class="btn btn-ghost !py-0.5 !px-2 text-sm text-blue-600">
              刷新全部
            </button>
          </div>

          <!-- 中央：控制 -->
          <div class="flex items-center gap-2">

            <button id="multi-start-selected-btn" class="btn btn-ghost !py-0.5 !px-2 text-sm text-green-600">
              开始选中
            </button>
            <button id="multi-stop-selected-btn" class="btn btn-ghost !py-0.5 !px-2 text-sm text-green-600">
              停止选中
            </button>
          </div>

          <!-- 右侧：移除 -->
          <div class="flex items-center gap-2">

            <button id="multi-remove-selected-btn" class="btn btn-ghost !py-0.5 !px-2 text-sm text-red-600">
              移除选中
            </button>
            <button id="multi-remove-all-btn" class="btn btn-ghost !py-0.5 !px-2 text-sm text-red-600">
              移除全部
            </button>
          </div>
        </div>





















        <div id="multi-account-list" class="flex-grow overflow-y-auto -mr-2 pr-2" style="max-height: 42vh;">
          <p class="text-slate-400 text-center py-10">请先添加或导入账号</p>
        </div>
        <div class="mt-2 border-t pt-3 flex items-center gap-2">
          <select id="multi-config-user-select" class="select-field !py-1 flex-grow"></select>
          <button id="multi-add-from-config-btn" class="btn btn-ghost !py-1 !px-2 flex-shrink-0">添加</button>
          <button id="multi-load-all-from-config-btn" class="btn btn-ghost !py-1 !px-2 flex-shrink-0">添加全部</button>
        </div>
      </div>
      <div class="panel rounded-xl p-4 flex-shrink-0">
        <h3 class="font-bold text-slate-800 mb-2">全局参数</h3>
        <div id="multi-global-params-container" class="h-40 overflow-y-auto pr-1"></div>
      </div>
    </div>
    <div class="flex flex-col gap-4 h-full min-h-0">
      <div id="multi-map-container"
        class="flex-grow bg-slate-200 rounded-xl relative overflow-hidden border border-slate-200">
        <div
          class="absolute top-4 right-3 z-10 bg-white/80 backdrop-blur-sm rounded-full shadow-md flex items-center space-x-1 p-1 border border-slate-200">
          <button id="multi-zoom-in"
            class="w-9 h-9 font-bold text-xl text-center hover:bg-slate-100 rounded-full text-slate-700">+</button>
          <span id="multi-zoom-level" class="text-xs font-mono select-none w-8 text-center">17</span>
          <button id="multi-zoom-out"
            class="w-9 h-9 font-bold text-xl text-center hover:bg-slate-100 rounded-full text-slate-700">-</button>
          <button id="multi-reset-view-btn"
            class="w-9 h-9 font-bold text-lg flex items-center justify-center hover:bg-slate-100 rounded-full text-slate-700"
            title="复位视角">🎯</button>
        </div>
      </div>
      <div class="panel rounded-xl p-4 h-48 flex flex-col">
        <h3 class="font-bold text-slate-800 mb-2">全局日志</h3>
        <textarea id="multi-log-text" readonly
          class="w-full flex-grow bg-white/80 border border-slate-200 rounded-md p-2 text-xs text-slate-700 resize-none focus:outline-none leading-snug"></textarea>
      </div>
    </div>
  </main>
<!-- 段落结束： multi-account-app -->

<!-- 段落开始： main-app -->
<main id="main-app" class="hidden h-screen w-screen grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-4 p-4">
    <!-- 左侧面板 -->
    <div class="lg:col-span-1 xl:col-span-1 flex flex-col gap-4 h-full min-h-0">
      <!-- 用户信息卡片 -->
      <div class="panel rounded-xl p-4 flex items-center gap-4">
        <div class="flex-1 ">
          <p id="user-name-label" class="font-bold text-slate-800 truncate">姓名: NULL</p>
          <p id="user-id-label" class="text-sm text-slate-500">学号: NULL</p>
        </div>

        <button id="show-notifications-btn" class="btn btn-ghost !py-2 !px-3 relative" title="查看通知">
          <span>通知</span>
          <span id="notification-badge"
            class="hidden absolute -top-1 -right-1 w-4 h-4 rounded-full bg-red-500 text-white text-[10px] font-bold flex items-center justify-center">0</span>
        </button>
        <button id="show-user-details" class="btn btn-ghost !py-2 !px-3" title="查看用户详情">详情</button>
        <button id="show-admin-panel" class="btn btn-ghost !py-2 !px-3 hidden" title="管理面板">管理</button>
        <button id="logout-button" class="btn btn-ghost !py-2 !px-3 !text-red-600" title="注销">退出</button>
      </div>
      <!-- 任务列表面板 -->
      <div class="panel rounded-xl p-4 flex-grow flex flex-col min-h-0">
        <div class="flex justify-between items-center mb-3">
          <h2 class="text-lg font-bold text-slate-800">任务列表</h2>
          <div class="flex gap-2">
            <button id="show-task-details" class="btn btn-ghost !py-1 !px-3">任务详情</button>
            <button id="refresh-button" class="btn btn-ghost !py-1 !px-3">刷新</button>
          </div>
        </div>
        <div id="task-list" class="flex-grow overflow-y-auto -mr-2 pr-2"></div>
      </div>
      <!-- 控制面板 (选项卡) -->
      <div class="panel rounded-xl p-4">
        <div class="flex border-b border-slate-200 -mx-4 px-2 space-x-2">
          <button class="tab-button active" onclick="showTab('run-control', this)">执行</button>
          <button class="tab-button" onclick="showTab('path-tools', this)">路径</button>
          <button class="tab-button" onclick="showTab('checkpoints', this)">打卡点</button>
          <button class="tab-button" onclick="showTab('attendance', this)">签到</button>
          <button class="tab-button" onclick="showTab('history', this)">历史</button>
          <button class="tab-button" onclick="showTab('params', this)">参数</button>
          <button class="tab-button" onclick="showTab('log', this)">日志</button>
        </div>
        <div class="h-56 overflow-y-auto">
          <!-- 执行选项卡 -->
          <div id="run-control-tab" class="pt-4 space-y-3">
            <div id="run-stats-block" class="text-center p-3 rounded-lg border border-slate-200 bg-white/80">
              <p class="text-sm text-slate-500">已选任务总览</p>
              <p id="run-stats-label" class="font-bold text-2xl text-sky-600">-- km / --:--</p>
            </div>

            <!-- 单任务进度条 -->
            <div id="single-progress-block" class="mt-2">
              <div class="h-2 bg-slate-200 rounded-full overflow-hidden">
                <div id="single-progress-fill" class="h-2 bg-sky-500" style="width:0%"></div>
              </div>
              <div class="flex justify-between text-xs mt-1">
                <span id="single-progress-text" class="text-slate-600">未开始</span>
                <span id="single-progress-extra" class="text-slate-400"></span>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <button id="start-run-button" class="btn btn-primary">开始执行</button>
              <button id="start-all-button" class="btn btn-secondary">执行所有</button>
            </div>

            <div class="flex items-center justify-center space-x-4 pt-1">
              <label class="flex items-center gap-1.5 text-xs text-slate-700 cursor-pointer"><input type="checkbox"
                  id="run-completed-check" class="w-4 h-4 accent-sky-600 rounded"><span
                  class="font-semibold">忽略已完成状态</span></label>
              <label class="flex items-center gap-1.5 text-xs text-slate-700 cursor-pointer"><input type="checkbox"
                  id="auto-gen-all-check" class="w-4 h-4 accent-sky-600 rounded"><span
                  class="font-semibold">自动生成路径</span></label>
            </div>
          </div>
          <!-- 路径工具选项卡 -->
          <div id="path-tools-tab" class="hidden pt-4 space-y-3">
            <div class="grid grid-cols-2 gap-3">
              <button id="record-button" class="btn btn-success">录制路径</button>
              <button id="auto-gen-button" class="btn btn-secondary">自动生成</button>
              <button id="process-button" class="btn btn-primary">处理路径</button>
              <button id="clear-button" class="btn btn-warning">清除路径</button>
            </div>
            <div class="grid grid-cols-2 gap-3">
              <button id="export-button" class="btn btn-ghost border border-slate-300 col-span-1">导出</button>
              <div class="col-span-1"></div>
            </div>
          </div>
          <!-- 打卡点选项卡 -->
          <div id="checkpoints-tab" class="hidden pt-2">
            <div id="target-points-text" class="h-48 overflow-y-auto"></div>
          </div>


          <div id="attendance-tab" class="hidden pt-2 space-y-2 h-56 flex flex-col">
            <div class="flex-shrink-0 space-y-2 border-b pb-2">
              <label class="flex items-center gap-2 cursor-pointer" title="开启后，将在后台自动刷新通知并尝试签到">
                <input type="checkbox" id="param-auto_attendance_enabled" data-key="auto_attendance_enabled"
                  class="w-5 h-5 accent-sky-600 rounded cursor-pointer flex-shrink-0">
                <span class="text-slate-700 font-semibold">开启自动签到</span>
              </label>

              <div class="flex items-center gap-2">
                <label class="text-sm text-slate-700 font-semibold flex-shrink-0">刷新间隔(秒)</label>
                <input type="number" step="30" id="param-auto_attendance_refresh_s" data-key="auto_attendance_refresh_s"
                  class="input-field !py-1 w-full" title="自动刷新通知的间隔时间（秒），建议不低于60">
              </div>
              <div class="flex items-center gap-2">
                <label class="text-sm text-slate-700 font-semibold flex-shrink-0">随机半径(米)</label>
                <input type="number" step="1" id="param-attendance_user_radius_m" data-key="attendance_user_radius_m"
                  class="input-field !py-1 w-full" title="自动签到时，在服务器允许范围内的最大随机偏移半径。设为0为精确签到。">
              </div>
            </div>
            <div class="flex justify-between items-center border-t pt-2 mt-2">
              <h4 class="text-sm font-semibold text-slate-700">签到任务列表</h4>
              <button id="refresh-attendance-list-btn" class="btn btn-ghost !py-0 !px-2 !text-xs text-sky-600"
                onclick="refreshNotificationsUI()">
                刷新
              </button>
            </div>

            <div id="attendance-list" class="flex-grow overflow-y-auto pr-1">
              <p class="text-slate-400 text-center py-10 text-xs">点击“刷新”按钮查看签到任务</p>
            </div>
          </div>

          <!-- 历史记录选项卡 -->
          <div id="history-tab" class="hidden pt-2">
            <div id="history-list-container">
              <p id="history-placeholder" class="text-slate-400 text-center py-16">选择任务后显示历史记录</p>
              <div id="history-list"></div>
            </div>
          </div>
          <!-- 参数设置选项卡 -->
          <div id="params-tab" class="hidden space-y-3">
            <div id="params-container"></div>
          </div>
          <!-- 日志选项卡 -->
          <div id="log-tab" class="hidden pt-2">
            <div class="h-48">
              <textarea id="log-text" readonly
                class="w-full h-full bg-white/80 border border-slate-200 rounded-md p-2 text-xs text-slate-700 resize-none focus:outline-none leading-snug"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 右侧主区域 -->
    <div class="lg:col-span-2 xl:col-span-3 flex flex-col gap-4 h-full min-h-0">
      <!-- 地图容器 -->
      <div id="map-container"
        class="flex-grow bg-slate-200 rounded-xl relative overflow-hidden border border-slate-200">
        <div
          class="absolute top-4 right-3 z-10 bg-white/80 backdrop-blur-sm rounded-full shadow-md flex items-center space-x-1 p-1 border border-slate-200">
          <button id="zoom-in"
            class="w-9 h-9 font-bold text-xl text-center hover:bg-slate-100 rounded-full text-slate-700">+</button>
          <span id="zoom-level" class="text-xs font-mono select-none w-8 text-center">17</span>
          <button id="zoom-out"
            class="w-9 h-9 font-bold text-xl text-center hover:bg-slate-100 rounded-full text-slate-700">-</button>
          <button id="reset-view-btn"
            class="w-9 h-9 font-bold text-lg flex items-center justify-center hover:bg-slate-100 rounded-full text-slate-700"
            title="复位视角">🎯</button>
        </div>
      </div>
      <!-- 底部信息面板 -->
      <div class="grid grid-cols-1 gap-4">
        <!-- 实时状态 -->
        <div class="panel rounded-xl p-4 flex flex-col gap-3">
          <div class="flex items-center justify-between">
            <h3 class="font-bold text-slate-800">实时状态</h3>
            <p class="text-sm font-mono text-slate-500" id="current-location-label">当前位置GPS坐标: --, --</p>
          </div>
          <div class="grid grid-cols-4 divide-x divide-slate-200 text-center pt-2">
            <div>
              <p class="text-sm text-slate-500">已跑距离</p>
              <p id="live-dist-label" class="font-bold text-xl text-slate-700">0.00 km</p>
            </div>
            <div>
              <p class="text-sm text-slate-500">总距离</p>
              <p id="total-dist-label" class="font-bold text-xl text-slate-700">0.00 km</p>
            </div>
            <div>
              <p class="text-sm text-slate-500">已用时间</p>
              <p id="live-time-label" class="font-bold text-xl text-slate-700">00:00</p>
            </div>
            <div>
              <p class="text-sm text-slate-500">预计时间</p>
              <p id="total-time-label" class="font-bold text-xl text-slate-700">00:00</p>
            </div>
          </div>
        </div>
      </div>
    </div>


  </main>
<!-- 段落结束： main-app -->

<!-- 段落开始： login-container -->
<div id="login-container" class="w-full h-full grid grid-cols-1 lg:grid-cols-3">

    <div class="flex flex-col items-center justify-center p-12 bg-gradient-to-br from-slate-50 to-gray-100">
      <div class="text-center w-full max-w-sm space-y-6">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mx-auto text-violet-500" viewBox="0 0 24 24"
          fill="currentColor">
          <path
            d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05c1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
        </svg>

        <h2 class="text-3xl font-bold text-slate-800 card-title">多账号模式</h2>
        <p class="text-slate-500">
          支持批量导入、统一管理和一键执行所有任务。
        </p>

        <button id="multi-account-btn" class="btn btn-secondary w-full py-3">进入多账号控制台</button>
      </div>
    </div>

    <div
      class="flex flex-col items-center justify-center p-6 md:p-12 bg-gradient-to-r from-slate-50 via-white to-slate-50"
      id="admin-panel-modal-Inline">
      <div class="panel rounded-2xl w-full max-w-2xl p-6 space-y-4 bg-white/90 flex flex-col overflow-x-hidden"
        style="max-height: calc(100vh - 12rem);">
        <h3 class="text-xl font-bold text-sky-600 text-center mb-4">会话管理</h3>

        <!-- Session management panel for inline (login page) -->
        <div id="admin-sessions-panel" class="space-y-4 overflow-y-auto overflow-x-hidden flex-grow min-h-0">
          <div class="flex justify-between items-center">
            <h4 class="font-semibold">会话列表</h4>
            <div class="flex items-center gap-3">
              <label id="god-mode-toggle" class="flex items-center gap-2 cursor-pointer" style="display:none;">
                <input type="checkbox" id="god-mode-checkbox" class="w-4 h-4 accent-red-600 rounded cursor-pointer">
                <span class="text-sm font-semibold text-red-600">上帝模式</span>
              </label>
              <div id="admin-session-count-display-inline" class="text-sm text-slate-600">
                <!-- 会话计数将由JS动态填充 -->
              </div>
              <button id="admin-refresh-sessions-inline" class="btn btn-ghost !py-1 !px-2">刷新</button>
            </div>
          </div>
          <div id="admin-sessions-list-inline" class="space-y-2 max-h-[50vh] overflow-y-auto">
            <p class="text-slate-400 text-center py-10">加载中...</p>
          </div>
        </div>
      </div>
    </div>

    <div class="flex items-center justify-center p-8 bg-white">
      <div class="panel rounded-2xl w-full max-w-md p-8 space-y-6">
        <div class="flex items-center gap-3">
          <h2 class="text-3xl font-bold text-sky-700 card-title">单账号登录</h2>
        </div>
        <div class="space-y-4 w-full">
          <div>
            <label class="block text-sm font-semibold leading-6 text-slate-700">选择账号</label>
            <select id="user-combo" class="select-field mt-1" title="选择已保存的账号或创建新账号" aria-label="选择账号"></select>
          </div>
          <div>
            <label class="block text-sm font-semibold leading-6 text-slate-700">用户名</label>
            <input type="text" id="username-entry" class="input-field mt-1" placeholder="你的学号或工号">
          </div>
          <div>
            <label class="block text-sm font-semibold leading-6 text-slate-700">密码</label>
            <input type="password" id="password-entry" class="input-field mt-1" placeholder="你的密码">
          </div>
        </div>
        <button id="login-button" class="btn btn-primary w-full py-3">登录</button>
        <div class="relative flex py-2 items-center">
          <div class="flex-grow border-t border-slate-200"></div>
          <span class="flex-shrink mx-4 text-slate-400 text-xs">或</span>
          <div class="flex-grow border-t border-slate-200"></div>
        </div>
        <button id="import-button" class="btn btn-success w-full">导入离线文件</button>

        <div class="pt-2">
          <div class="flex justify-between items-center text-xs text-slate-500 mb-1">
            <span>User-Agent</span>
            <button id="random-ua-btn" title="随机生成新的UA" class="btn btn-ghost !py-1 !px-2">随机</button>
          </div>
          <p id="ua-label" class="text-xs text-slate-600 break-all bg-white/70 border border-slate-200 p-2 rounded-md">
            (未加载) </p>
        </div>
      </div>
    </div>

  </div>
<!-- 段落结束： login-container -->

<!-- 段落开始： auth-login-container -->
<div id="auth-login-container" class="hidden w-full h-full flex items-center justify-center">
    <div class="panel rounded-2xl w-full max-w-md p-8 space-y-6">
      <div class="text-center">
        <h2 class="text-3xl font-bold text-sky-700 card-title mb-2">跑步助手</h2>
        <p class="text-sm text-slate-500">请登录或注册以继续使用</p>
      </div>

      <!-- 登录/注册切换标签 -->
      <div class="flex border-b border-slate-200">
        <button id="auth-tab-login"
          class="flex-1 py-3 font-semibold text-sky-600 border-b-2 border-sky-600 transition">登录</button>
        <button id="auth-tab-register"
          class="flex-1 py-3 font-semibold text-slate-400 border-b-2 border-transparent transition hover:text-slate-600">注册</button>
      </div>

      <!-- 登录表单 -->
      <div id="auth-login-form" class="space-y-4">
        <div>
          <label class="block text-sm font-semibold leading-6 text-slate-700">用户名</label>
          <input type="text" id="auth-username" class="input-field mt-1" placeholder="请输入用户名" autocomplete="username">
        </div>
        <div>
          <label class="block text-sm font-semibold leading-6 text-slate-700">密码</label>
          <input type="password" id="auth-password" class="input-field mt-1" placeholder="请输入密码"
            autocomplete="current-password">
        </div>
        <button id="auth-login-btn" class="btn btn-primary w-full py-3">登录</button>
        <div id="guest-login-section" class="text-center hidden">
          <div class="relative flex py-2 items-center">
            <div class="flex-grow border-t border-slate-200"></div>
            <span class="flex-shrink mx-4 text-slate-400 text-xs">或</span>
            <div class="flex-grow border-t border-slate-200"></div>
          </div>
          <button id="auth-guest-btn" class="btn btn-ghost w-full">以游客身份继续</button>
          <!-- 游客模式警告 -->
          <div class="mt-4 p-3 rounded-lg bg-amber-50 border border-amber-200 text-left">
            <div class="flex items-start gap-2">
              <svg class="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                  d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" />
              </svg>
              <div class="text-xs text-amber-800">
                <p class="font-semibold mb-1">⚠️ 游客模式提示</p>
                <ul class="space-y-1">
                  <li>• 游客使用UUID恢复状态，请务必保存地址</li>
                  <li>• 丢失URL将无法恢复您的数据和进度</li>
                  <li>• 5分钟不活跃会话将被自动清理</li>
                  <li>• 建议注册账号以获得更好的体验</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 注册表单 -->
      <div id="auth-register-form" class="hidden space-y-4">
        <div>
          <label class="block text-sm font-semibold leading-6 text-slate-700">用户名</label>
          <input type="text" id="auth-reg-username" class="input-field mt-1" placeholder="请输入用户名（3-20字符）"
            autocomplete="username">
        </div>
        <div>
          <label class="block text-sm font-semibold leading-6 text-slate-700">密码</label>
          <input type="password" id="auth-reg-password" class="input-field mt-1" placeholder="请输入密码（至少6字符）"
            autocomplete="new-password">
        </div>
        <div>
          <label class="block text-sm font-semibold leading-6 text-slate-700">确认密码</label>
          <input type="password" id="auth-reg-password-confirm" class="input-field mt-1" placeholder="请再次输入密码"
            autocomplete="new-password">
        </div>
        <button id="auth-register-btn" class="btn btn-success w-full py-3">注册</button>
      </div>

      <!-- 2FA验证表单 -->
      <div id="auth-2fa-form" class="hidden space-y-4">
        <div class="text-center mb-4">
          <h3 class="text-xl font-bold text-sky-700 mb-2">双因素认证</h3>
          <p class="text-sm text-slate-500">请输入您的验证器应用中的6位验证码</p>
        </div>
        <div>
          <label class="block text-sm font-semibold leading-6 text-slate-700">验证码</label>
          <input type="text" id="auth-2fa-code" class="input-field mt-1" placeholder="输入6位验证码" maxlength="6"
            inputmode="numeric" pattern="[0-9]{6}" autocomplete="one-time-code">
        </div>
        <button id="auth-2fa-verify-btn" class="btn btn-primary w-full py-3">验证</button>
        <button id="auth-2fa-back-btn" class="btn btn-ghost w-full">返回登录</button>
      </div>

      <!-- 错误提示 -->
      <div id="auth-error-msg"
        class="hidden text-sm text-center p-3 rounded-lg bg-red-50 border border-red-200 text-red-600"></div>
      <div id="auth-success-msg"
        class="hidden text-sm text-center p-3 rounded-lg bg-green-50 border border-green-200 text-green-600"></div>
    </div>
  </div>
<!-- 段落结束： auth-login-container -->

<!-- 段落开始： admin-panel-modal -->
<div id="admin-panel-modal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/40" onclick="toggleAdminPanel(false)"></div>
    <div class="panel rounded-2xl p-6 w-[50rem] max-h-[80vh] overflow-x-hidden space-y-4 relative flex flex-col">

      <div class="relative mb-4 text-center flex-shrink-0">
        <h3 class="text-2xl font-bold text-sky-600 inline-block">管理面板</h3>

        <button id="admin-modal-close-btn"
          class="absolute top-1/2 right-0 transform -translate-y-1/2 btn btn-ghost !py-1 !px-3"
          onclick="toggleAdminPanel(false)">关闭</button>
      </div>
      <div class="flex border-b border-slate-200 flex-shrink-0">
        <button id="admin-tab-users_modal" class="px-4 py-2 font-semibold text-sky-600 border-b-2 border-sky-600"
          style="display:none;">用户管理</button>
        <button id="admin-tab-groups_modal" class="px-4 py-2 font-semibold text-slate-400 border-b-2 border-transparent"
          style="display:none;">权限组管理</button>
        <button id="admin-tab-logs_modal" class="px-4 py-2 font-semibold text-slate-400 border-b-2 border-transparent"
          style="display:none;">日志查看</button>
        <button id="admin-tab-health_modal" class="px-4 py-2 font-semibold text-slate-400 border-b-2 border-transparent"
          style="display:none;">系统状态</button>
        <button id="admin-tab-profile_modal"
          class="px-4 py-2 font-semibold text-slate-400 border-b-2 border-transparent">个人信息</button>
        <button id="admin-tab-sessions_modal"
          class="px-4 py-2 font-semibold text-slate-400 border-b-2 border-transparent">会话管理</button>
        <button id="admin-tab-messages_modal"
          class="px-4 py-2 font-semibold text-slate-400 border-b-2 border-transparent">留言板</button>
      </div>

      <div class="overflow-y-auto overflow-x-hidden flex-grow min-h-0">
        <div id="admin-users-panel_modal" class="space-y-4">
          <div class="flex justify-between items-center">
            <h4 class="font-semibold">用户列表</h4>
            <div class="flex gap-2">
              <button id="admin-create-user_modal" class="btn btn-primary !py-1 !px-2">新增用户</button>
              <button id="admin-refresh-users_modal" class="btn btn-ghost !py-1 !px-2">刷新</button>
            </div>
          </div>
          <div id="admin-users-list_modal" class="space-y-2">
            <p class="text-slate-400 text-center py-10">加载中...</p>
          </div>
        </div>

        <div id="admin-groups-panel_modal" class="hidden space-y-4">
          <div class="flex justify-between items-center">
            <h4 class="font-semibold">权限组列表</h4>
            <div class="flex gap-2">
              <button id="admin-create-group_modal" class="btn btn-primary !py-1 !px-2">新增权限组</button>
              <button id="admin-refresh-groups_modal" class="btn btn-ghost !py-1 !px-2">刷新</button>
            </div>
          </div>
          <div id="admin-groups-list_modal" class="space-y-2">
            <p class="text-slate-400 text-center py-10">加载中...</p>
          </div>
        </div>

        <div id="admin-logs-panel_modal" class="hidden space-y-4">
          <div class="flex justify-between items-center">
            <h4 class="font-semibold">系统日志</h4>
            <div class="flex gap-2">
              <select id="log-limit-select_modal" class="text-sm border border-slate-300 rounded px-2 py-1">
                <option value="100">每页100行</option>
                <option value="200">每页200行</option>
                <option value="500">每页500行</option>
                <option value="1000">每页1000行</option>
              </select>
              <button id="admin-refresh-logs_modal" class="btn btn-ghost !py-1 !px-2">刷新</button>
            </div>
          </div>
          <div class="bg-slate-900 text-green-400 rounded-lg p-4 font-mono text-xs overflow-auto max-h-[49vh]">
            <pre id="admin-logs-content_modal" class="whitespace-pre-wrap overflow-visible">加载中...</pre>
          </div>
          <div id="admin-logs-pagination" class="flex justify-between items-center text-sm text-slate-600 pt-2 border-t border-slate-200">
        <button id="log-prev-page" class="btn btn-ghost !py-1 !px-3 disabled:opacity-50 disabled:cursor-not-allowed">上一页</button>
        
        <div class="flex items-center gap-2">
          <select id="log-page-select" class="text-sm border border-slate-300 rounded px-2 py-1 bg-white focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none cursor-pointer">
            <option value="1">第 1 / 1 页</option>
          </select>
          <span id="log-page-total" class="text-sm text-slate-500 whitespace-nowrap">(共 0 行)</span>
        </div>
        
        <button id="log-next-page" class="btn btn-ghost !py-1 !px-3 disabled:opacity-50 disabled:cursor-not-allowed">下一页</button>
      </div>
    </div>

    <div id="admin-sessions-panel_modal" class="hidden space-y-4">
          <div class="flex justify-between items-center">
            <h4 class="font-semibold">会话列表</h4>
            <div class="flex items-center gap-3">
              <label id="god-mode-toggle_modal" class="flex items-center gap-2 cursor-pointer" style="display:none;">
                <input type="checkbox" id="god-mode-checkbox_modal"
                  class="w-4 h-4 accent-red-600 rounded cursor-pointer">
                <span class="text-sm font-semibold text-red-600">上帝模式</span>
              </label>
              <div id="admin-session-count-display" class="text-sm text-slate-600">
                <!-- 会话计数将由JS动态填充 -->
              </div>
              <button id="admin-refresh-sessions_modal" class="btn btn-ghost !py-1 !px-2">刷新</button>
            </div>
          </div>
          <div id="admin-sessions-list_modal" class="space-y-2 max-h-[50vh] overflow-y-auto">
            <p class="text-slate-400 text-center py-10">加载中...</p>
          </div>
        </div>

        <!-- 健康状态面板 -->
        <div id="admin-health-panel_modal" class="hidden space-y-4">
          <div class="flex justify-between items-center">
            <h4 class="font-semibold">系统健康状态</h4>
            <div class="flex items-center gap-2">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" id="health-auto-refresh-toggle"
                  class="w-4 h-4 accent-sky-600 rounded cursor-pointer" checked>
                <span class="text-sm text-slate-600">自动刷新(5秒)</span>
              </label>
              <button id="admin-refresh-health_modal" class="btn btn-ghost !py-1 !px-2">手动刷新</button>
            </div>
          </div>
          <div id="admin-health-content_modal" class="space-y-4">
            <p class="text-slate-400 text-center py-10">加载中...</p>
          </div>
        </div>

        <!-- 个人信息面板 -->
        <div id="admin-profile-panel_modal" class="hidden space-y-4">
          <div class="flex justify-between items-center">
            <h4 class="font-semibold">个人信息</h4>
            <button id="admin-refresh-profile_modal" class="btn btn-ghost !py-1 !px-2">刷新</button>
          </div>
          <div id="admin-profile-content_modal" class="space-y-6">
            <!-- 头像 -->
            <div class="flex items-center gap-4">
              <img id="profile-avatar-display" src="" alt="用户头像"
                class="w-20 h-20 rounded-full border-2 border-slate-200"
                onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect width=%22100%22 height=%22100%22 fill=%22%23ddd%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2240%22 text-anchor=%22middle%22 dy=%22.3em%22%3E👤%3C/text%3E%3C/svg%3E'">
              <div class="flex-1 space-y-2">
                <input type="file" id="profile-avatar-file" accept="image/*" class="hidden"
                  onchange="previewAvatar(event)">

                <button class="btn btn-ghost border border-slate-300 !py-1.5 !px-3 text-sm"
                  onclick="document.getElementById('profile-avatar-file').click();">
                  <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                  </svg>
                  上传头像
                </button>

                <!-- <p class="text-xs text-slate-500">💡 点击按钮选择图片以上传并更新头像</p> -->
              </div>
            </div>

            <!-- 修改密码 -->
            <div class="border-t border-slate-200 pt-4">
              <h5 class="font-semibold text-slate-700 mb-3">修改密码</h5>
              <div class="space-y-3">
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-1">当前密码</label>
                  <input type="password" id="profile-current-password" class="input-field" placeholder="输入当前密码">
                </div>
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-1">新密码</label>
                  <input type="password" id="profile-new-password" class="input-field" placeholder="输入新密码">
                </div>
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-1">确认新密码</label>
                  <input type="password" id="profile-confirm-password" class="input-field" placeholder="再次输入新密码">
                </div>
                <button onclick="updatePassword()" class="btn btn-primary">修改密码</button>
              </div>
            </div>

            <!-- 2FA设置 -->
            <div class="border-t border-slate-200 pt-4">
              <h5 class="font-semibold text-slate-700 mb-3">双因素认证(2FA)</h5>
              <div id="profile-2fa-status" class="mb-3">
                <p class="text-sm text-slate-600">状态: <span id="profile-2fa-enabled">检测中...</span></p>
              </div>
              <div id="profile-2fa-setup" class="space-y-3 hidden">
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 text-center">
                  <canvas id="profile-2fa-qr" class="mx-auto"></canvas>
                  <p class="text-xs text-slate-600 mt-2">密钥: <span id="profile-2fa-secret" class="font-mono"></span></p>
                  <p class="text-xs text-slate-600 mt-1">请使用Google Authenticator或类似应用扫描此二维码</p>
                </div>
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-1">验证码</label>
                  <input type="text" id="profile-2fa-code" class="input-field" placeholder="输入6位验证码">
                </div>
                <button onclick="enable2FA()" class="btn btn-primary">启用2FA</button>
              </div>
              <div id="profile-2fa-actions" class="space-y-2">
                <button onclick="generate2FA()" class="btn btn-primary">生成2FA密钥</button>
              </div>
              <div id="profile-2fa-enabled-actions" class="space-y-2 hidden">
                <button onclick="test2FA()" class="btn btn-ghost">测试2FA</button>
                <button onclick="disable2FA()" class="btn btn-warning">关闭2FA</button>
              </div>
            </div>

            <!-- 主题设置 -->
            <div class="border-t border-slate-200 pt-4">
              <h5 class="font-semibold text-slate-700 mb-3">主题设置</h5>
              <select id="profile-theme-select" onchange="updateTheme()" class="select-field">
                <option value="light">浅色主题</option>
                <option value="dark">深色主题</option>
              </select>
            </div>
          </div>
        </div>

        <!-- 留言板面板 -->
        <div id="admin-messages-panel_modal" class="hidden space-y-4">
          <div class="flex justify-between items-center">
            <h4 class="font-semibold">留言板</h4>
            <button id="admin-refresh-messages_modal" class="btn btn-ghost !py-1 !px-2">刷新</button>
          </div>

          <!-- 发表留言表单 -->
          <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 space-y-3">
            <h5 class="font-semibold text-slate-700">发表留言</h5>
            <div id="message-guest-fields" class="space-y-2 hidden">
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">昵称 <span
                    class="text-red-500">*</span></label>
                <input type="text" id="message-nickname" class="input-field" placeholder="请输入您的昵称" maxlength="50">
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">邮箱 <span
                    class="text-red-500">*</span></label>
                <input type="email" id="message-email" class="input-field" placeholder="请输入您的邮箱">
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold text-slate-700 mb-1">留言内容 <span
                  class="text-red-500">*</span></label>
              <textarea id="message-content" class="input-field" rows="4" placeholder="请输入留言内容（最多1000字）"
                maxlength="1000"></textarea>
              <div class="text-xs text-slate-500 mt-1 text-right">
                <span id="message-char-count">0</span> / 1000
              </div>
            </div>
            <button id="post-message-btn" onclick="postMessage()" class="btn btn-primary w-full">发表留言</button>
          </div>

          <!-- 留言列表 -->
          <div id="admin-messages-list_modal" class="space-y-3 max-h-[50vh] overflow-y-auto">
            <p class="text-slate-400 text-center py-10">加载中...</p>
          </div>
        </div>
      </div>
    </div>
  </div>
<!-- 段落结束： admin-panel-modal -->

<!-- 段落开始： auto-gen-modal -->
<div id="auto-gen-modal" class="fixed inset-0 flex items-center justify-center hidden z-50">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="panel rounded-2xl p-6 w-96 space-y-6 relative">
      <h3 class="text-xl font-bold text-sky-600 text-center">自动生成路线配置</h3>
      <div class="space-y-4">
        <div class="flex items-center">
          <label class="w-32 text-slate-700 font-semibold">最短时间(分钟)</label>
          <input id="min-time-input" type="number" value="20" class="input-field w-full">
        </div>
        <div class="flex items-center">
          <label class="w-32 text-slate-700 font-semibold">最长时间(分钟)</label>
          <input id="max-time-input" type="number" value="30" class="input-field w-full">
        </div>
        <div class="flex items-center">
          <label class="w-32 text-slate-700 font-semibold">最短距离(米)</label>
          <input id="min-dist-input" type="number" value="2000" class="input-field w-full">
        </div>
      </div>
      <div class="flex justify-end gap-3 pt-4">
        <button id="cancel-gen-button" class="btn btn-ghost border border-slate-300">取消</button>
        <button id="confirm-gen-button" class="btn btn-primary">生成</button>
      </div>
    </div>
  </div>
<!-- 段落结束： auto-gen-modal -->

<!-- 段落开始： notifications-modal -->
<div id="notifications-modal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/40" onclick="toggleNotifications(false)"></div>
    <div class="panel rounded-2xl p-6 w-[36rem] space-y-4 relative">
      <h3 class="text-xl font-bold text-sky-600 text-center">通知中心</h3>
      <div id="notifications-content" class="text-sm space-y-2 max-h-[70vh] overflow-y-auto pr-2">
        <p class="text-slate-400 text-center py-10">正在加载...</p>
      </div>
      <div class="flex justify-between items-center pt-2">
        <div class="flex gap-2"> <button id="refresh-notifications-btn"
            class="btn btn-ghost !py-1 !px-3 text-sky-600">刷新</button>
          <button id="mark-all-read-btn" class="btn btn-secondary !py-1 !px-3">一键已读</button>
        </div>
        <button class="btn btn-ghost border border-slate-300" onclick="toggleNotifications(false)">关闭</button>
      </div>
    </div>
  </div>
<!-- 段落结束： notifications-modal -->

<!-- 段落开始： session-picker-modal -->
<div id="session-picker-modal" class="fixed inset-0 flex items-center justify-center hidden z-[1052]">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="panel rounded-2xl p-6 w-[40rem] max-h-[70vh] space-y-4 relative">
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-bold text-sky-600">会话管理</h3>
        <div id="session-count-display" class="text-sm text-slate-600">
          <!-- 会话计数将由JS动态填充 -->
        </div>
      </div>

      <div class="bg-sky-50 border border-sky-200 rounded-lg p-3">
        <p class="text-sm text-slate-700 mb-2">选择现有会话或创建新会话</p>
        <button class="btn btn-primary w-full" onclick="createNewSessionFromPicker()">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
          </svg>
          创建新会话
        </button>
      </div>

      <div class="space-y-2">
        <div class="flex justify-between items-center">
          <h4 class="font-semibold text-slate-700">现有会话</h4>
          <button class="btn btn-ghost !py-1 !px-2" onclick="refreshSessionPicker()">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
              </path>
            </svg>
            刷新
          </button>
        </div>
        <div id="session-picker-list" class="max-h-[40vh] overflow-y-auto space-y-2">
          <p class="text-slate-400 text-center py-10">加载中...</p>
        </div>
      </div>

      <div class="border-t pt-3 text-xs text-slate-500">
        <p>💡 提示：每个会话都是独立的学校账号登录状态。您可以创建多个会话来管理不同的账号。</p>
      </div>
    </div>
  </div>
<!-- 段落结束： session-picker-modal -->

<!-- 段落开始： create-group-modal -->
<div id="create-group-modal" class="fixed inset-0 flex items-center justify-center hidden z-[1054]">
    <div class="absolute inset-0 bg-black/60" onclick="closeCreateGroupModal()"></div>
    <div class="panel rounded-2xl p-6 w-[50rem] max-h-[80vh] overflow-y-auto space-y-4 relative">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-sky-600">创建权限组</h3>
        <button onclick="closeCreateGroupModal()" class="btn btn-ghost !py-1 !px-3">关闭</button>
      </div>

      <div class="space-y-3">
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">权限组键名</label>
          <input type="text" id="new-group-key" class="input-field w-full" placeholder="例如: custom_group">
          <p class="text-xs text-slate-500 mt-1">英文字母、数字、下划线，用于内部标识</p>
        </div>
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">权限组名称</label>
          <input type="text" id="new-group-name" class="input-field w-full" placeholder="例如: 自定义权限组">
          <p class="text-xs text-slate-500 mt-1">显示名称，用于界面展示</p>
        </div>
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-2">权限设置</label>
          <div id="create-group-permissions"
            class="grid grid-cols-2 gap-2 max-h-[40vh] overflow-y-auto border border-slate-200 rounded-lg p-3">
            <!-- 权限列表将由JS动态填充 -->
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-3 pt-4 border-t">
        <button onclick="closeCreateGroupModal()" class="btn btn-ghost border border-slate-300">取消</button>
        <button onclick="submitCreateGroup()" class="btn btn-primary">创建</button>
      </div>
    </div>
  </div>
<!-- 段落结束： create-group-modal -->

<!-- 段落开始： edit-group-permissions-modal -->
<div id="edit-group-permissions-modal" class="fixed inset-0 flex items-center justify-center hidden z-[1054]">
    <div class="absolute inset-0 bg-black/60" onclick="closeEditGroupPermissionsModal()"></div>
    <div class="panel rounded-2xl p-6 w-[50rem] max-h-[80vh] overflow-y-auto space-y-4 relative">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-sky-600">编辑权限组: <span id="edit-group-name"></span></h3>
        <button onclick="closeEditGroupPermissionsModal()" class="btn btn-ghost !py-1 !px-3">关闭</button>
      </div>

      <div class="space-y-3">
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-2">权限设置</label>
          <div id="edit-group-permissions-list"
            class="grid grid-cols-2 gap-2 max-h-[50vh] overflow-y-auto border border-slate-200 rounded-lg p-3">
            <!-- 权限列表将由JS动态填充 -->
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-3 pt-4 border-t">
        <button onclick="closeEditGroupPermissionsModal()" class="btn btn-ghost border border-slate-300">取消</button>
        <button onclick="submitEditGroupPermissions()" class="btn btn-primary">保存</button>
      </div>
    </div>
  </div>
<!-- 段落结束： edit-group-permissions-modal -->

<!-- 段落开始： manage-user-permissions-modal -->
<div id="manage-user-permissions-modal" class="fixed inset-0 flex items-center justify-center hidden z-[1054]">
    <div class="absolute inset-0 bg-black/60" onclick="closeManageUserPermissionsModal()"></div>
    <div class="panel rounded-2xl p-6 w-[50rem] max-h-[80vh] overflow-y-auto space-y-4 relative">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-sky-600">管理用户权限: <span id="manage-user-name"></span></h3>
        <button onclick="closeManageUserPermissionsModal()" class="btn btn-ghost !py-1 !px-3">关闭</button>
      </div>

      <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
        <p class="text-sm text-blue-700">
          <strong>权限组:</strong> <span id="user-base-group" class="font-mono"></span>
        </p>
        <p class="text-xs text-slate-600 mt-1">
          💡 以下为用户相对于权限组的差分化权限。绿色表示额外添加的权限，红色表示移除的权限。
        </p>
      </div>

      <div class="space-y-3">
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-2">权限调整</label>
          <div id="manage-user-permissions-list"
            class="grid grid-cols-2 gap-2 max-h-[50vh] overflow-y-auto border border-slate-200 rounded-lg p-3">
            <!-- 权限列表将由JS动态填充 -->
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-3 pt-4 border-t">
        <button onclick="closeManageUserPermissionsModal()" class="btn btn-ghost border border-slate-300">取消</button>
        <button onclick="submitManageUserPermissions()" class="btn btn-primary">保存</button>
      </div>
    </div>
  </div>
<!-- 段落结束： manage-user-permissions-modal -->

<!-- 段落开始： set-max-sessions-modal -->
<div id="set-max-sessions-modal" class="fixed inset-0 flex items-center justify-center hidden z-[1054]">
    <div class="absolute inset-0 bg-black/60" onclick="hideModal('set-max-sessions-modal')"></div>
    <div class="panel rounded-2xl p-6 w-96 space-y-4 relative">
      <h3 class="text-xl font-bold text-sky-600">设置会话限制</h3>

      <div class="space-y-2">
        <p class="text-sm text-slate-600">用户: <span id="sessions-username" class="font-semibold text-slate-800"></span>
        </p>
        <p class="text-sm text-slate-600">当前限制: <span id="sessions-current-max"
            class="font-semibold text-slate-800"></span></p>
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">新会话限制</label>
        <input type="number" id="new-max-sessions" min="0" class="input-field" placeholder="输入会话数量">
        <p class="text-xs text-slate-500 mt-1">0 = 无限制</p>
      </div>

      <div class="flex justify-end gap-3 pt-4 border-t">
        <button onclick="hideModal('set-max-sessions-modal')" class="btn btn-ghost border border-slate-300">取消</button>
        <button onclick="submitSetMaxSessions()" class="btn btn-primary">确认</button>
      </div>
    </div>
  </div>
<!-- 段落结束： set-max-sessions-modal -->

<!-- 段落开始： reset-user-password-modal -->
<div id="reset-user-password-modal" class="fixed inset-0 flex items-center justify-center hidden z-[1054]">
    <div class="absolute inset-0 bg-black/60" onclick="hideModal('reset-user-password-modal')"></div>
    <div class="panel rounded-2xl p-6 w-96 space-y-4 relative">
      <h3 class="text-xl font-bold text-amber-600">重置用户密码</h3>

      <div>
        <p class="text-sm text-slate-600">目标用户: <span id="reset-password-username"
            class="font-semibold text-slate-800"></span></p>
      </div>

      <div class="space-y-3">
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">新密码</label>
          <input type="password" id="reset-new-password" class="input-field" placeholder="输入新密码">
        </div>
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-1">确认密码</label>
          <input type="password" id="reset-confirm-password" class="input-field" placeholder="再次输入新密码">
        </div>
      </div>

      <div class="flex justify-end gap-3 pt-4 border-t">
        <button onclick="hideModal('reset-user-password-modal')"
          class="btn btn-ghost border border-slate-300">取消</button>
        <button onclick="submitResetUserPassword()" class="btn btn-primary">重置密码</button>
      </div>
    </div>
  </div>
<!-- 段落结束： reset-user-password-modal -->

<!-- 段落开始： account-params-modal -->
<div id="account-params-modal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/40" onclick="
    const modalElem = this.parentElement;
    modalElem.classList.add('hidden'); 
    modalElem.classList.remove('flex'); 
    document.body.classList.remove('modal-visible');
  "></div>
    <div class="panel rounded-2xl p-6 w-[32rem] space-y-4 relative">
      <h3 id="account-params-title" class="text-xl font-bold text-sky-600 text-center">账号参数设置</h3>
      <div id="account-params-container" class="text-sm space-y-2 max-h-[60vh] overflow-y-auto pr-2"></div>
      <div class="flex justify-end pt-2 gap-3">
        <button class="btn btn-ghost border border-slate-300" onclick="
        const m = this.closest('#account-params-modal');
        m.classList.add('hidden'); 
        m.classList.remove('flex'); 
        document.body.classList.remove('modal-visible');
      ">关闭</button>

        <button id="save-account-params-btn" class="btn btn-primary">保存</button>
      </div>
    </div>
  </div>
<!-- 段落结束： account-params-modal -->

<!-- 段落开始： amap-key-modal -->
<div id="amap-key-modal" class="fixed inset-0 flex items-center justify-center hidden z-50">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="panel rounded-2xl p-6 w-96 space-y-6 relative">
      <h3 class="text-xl font-bold text-red-600 text-center">缺少地图API Key</h3>
      <p class="text-sm text-slate-600 text-center">
        程序需要一个有效的高德地图JS API Key才能使用地图功能。请前往
        <a href="https://console.amap.com/dev/key/app" target="_blank" class="text-sky-600 hover:underline">高德开放平台</a>
        申请一个Key（类型选择“Web端(JS API)”），然后粘贴到下方。
      </p>
      <div class="space-y-2">
        <label class="w-full text-slate-700 font-semibold">API Key:</label>
        <input id="amap-key-input" type="text" class="input-field w-full" placeholder="请在此处粘贴你的API Key">
      </div>
      <div class="flex justify-end gap-3 pt-4">
        <button id="confirm-amap-key-btn" class="btn btn-primary">确认并保存</button>
      </div>
    </div>
  </div>
<!-- 段落结束： amap-key-modal -->

<!-- 段落开始： avatar-crop-modal -->
<div id="avatar-crop-modal" class="fixed inset-0 flex items-center justify-center hidden z-[1055]">
    <div class="absolute inset-0 bg-black/80" onclick="closeCropModal()"></div>
    <div class="panel rounded-2xl p-6 max-w-2xl w-full mx-4 space-y-4 relative">
      <h3 class="text-xl font-bold text-sky-600">裁剪头像</h3>

      <div class="max-h-96 overflow-hidden bg-slate-100 rounded-lg">
        <img id="crop-image" src="" alt="待裁剪图片" style="max-width: 100%;">
      </div>

      <div class="flex gap-2 justify-end">
        <button onclick="closeCropModal()" class="btn btn-ghost border border-slate-300">取消</button>
        <button onclick="confirmCropAndUpload()" class="btn btn-primary">确认并上传</button>
      </div>
    </div>
  </div>
<!-- 段落结束： avatar-crop-modal -->

<!-- 段落开始： confirm-modal -->
<div id="confirm-modal" class="fixed inset-0 flex items-center justify-center hidden z-[1053]">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="panel rounded-2xl p-6 w-96 space-y-6 relative">
      <h3 id="confirm-modal-title" class="text-xl font-bold text-amber-600 text-center">请确认</h3>
      <p id="confirm-modal-message" class="text-sm text-slate-600 text-center py-4">
        你确定要执行此操作吗？
      </p>
      <div class="flex justify-end gap-3 pt-4">
        <button id="confirm-modal-cancel-btn" class="btn btn-ghost border border-slate-300">取消</button>
        <button id="confirm-modal-ok-btn" class="btn btn-primary">确认</button>
      </div>
    </div>
  </div>
<!-- 段落结束： confirm-modal -->

<!-- 段落开始： user-details-modal -->
<div id="user-details-modal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/40" onclick="toggleUserDetails(false)"></div>
    <div class="panel rounded-2xl p-6 w-[32rem] space-y-4 relative">
      <div class="flex items-center justify-center gap-2">
        <h3 class="text-xl font-bold text-sky-600 text-center">用户详情</h3>
      </div>
      <div id="user-details-content" class="text-sm space-y-1 max-h-[70vh] overflow-y-auto"></div>
      <div class="flex justify-end pt-2"><button class="btn btn-ghost border border-slate-300"
          onclick="toggleUserDetails(false)">关闭</button></div>
    </div>
  </div>
<!-- 段落结束： user-details-modal -->

<!-- 段落开始： task-details-modal -->
<div id="task-details-modal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/40" onclick="toggleTaskDetails(false)"></div>
    <div class="panel rounded-2xl p-6 w-[36rem] space-y-4 relative">
      <div class="flex items-center justify-center gap-2">
        <h3 class="text-xl font-bold text-sky-600 text-center">任务详情</h3>
      </div>
      <div id="task-details-content" class="text-sm space-y-1 max-h-[70vh] overflow-y-auto"></div>
      <div class="flex justify-end pt-2"><button class="btn btn-ghost border border-slate-300"
          onclick="toggleTaskDetails(false)">关闭</button></div>
    </div>
  </div>
<!-- 段落结束： task-details-modal -->

<!-- 段落开始： alert-modal -->
<div id="alert-modal" class="fixed inset-0 flex items-center justify-center hidden z-[1055]">
    <div class="absolute inset-0 bg-black/60" onclick="closeModalAlert()"></div>
    <div class="panel rounded-2xl p-6 w-96 space-y-6 relative">
      <h3 id="alert-modal-title" class="text-xl font-bold text-red-600 text-center">操作失败</h3>
      <p id="alert-modal-message" class="text-sm text-slate-600 text-center py-4">
        这是一个错误提示。
      </p>
      <div class="flex justify-center gap-3 pt-4">
        <button id="alert-modal-close-btn" class="btn btn-primary">关闭</button>
      </div>
    </div>
  </div>
<!-- 段落结束： alert-modal -->


<!-- 段落开始： newUserModal -->
<div id="newUserModal" class="modal">
    <div class="modal-content">
      <span class="close" id="newUserClose">&times;</span>
      <h3>添加新用户</h3>
      <div class="form-group">
        <label for="newUsername">账号：</label>
        <input type="text" id="newUsername" placeholder="请输入账号">
      </div>
<!-- 段落结束： newUserModal -->

<!-- 段落开始： cdn-error-overlay -->
<div id="cdn-error-overlay"
    class="fixed inset-0 z-9999 hidden flex-col items-center justify-center bg-[#f8fafc] p-8 text-center text-[#475569]"
    style="font-family: sans-serif;">
    <div style="max-width: 500px;">
      <h1 style="font-size: 1.875rem; font-weight: bold; color: #be123c; margin-bottom: 1rem;">界面资源加载失败</h1>
      <p style="font-size: 1.125rem; margin-bottom: 1.5rem;">应用程序无法连接到外部网络服务器（CDN）来下载必要的界面文件（如样式和地图库）。</p>
      <div
        style="background-color: #f1f5f9; border-radius: 0.5rem; padding: 1rem; text-align: left; font-size: 0.875rem; line-height: 1.5;">
        <h2 style="font-weight: 600; color: #1e293b; margin-top: 0; margin-bottom: 0.75rem;">可能的原因及解决方法：</h2>
        <ul style="list-style-type: disc; padding-left: 1.25rem; margin: 0;">
          <li style="margin-bottom: 0.5rem;"><strong>检查您的网络连接</strong>：请确保您的设备已连接到互联网。</li>
          <li style="margin-bottom: 0.5rem;"><strong>检查防火墙或代理</strong>：系统防火墙、杀毒软件或网络代理可能阻止了程序访问网络。</li>
          <li><strong>网络环境问题</strong>：您当前的网络环境可能无法稳定访问所需的外部资源。</li>
        </ul>
      </div>
      <p style="margin-top: 1.5rem; font-size: 0.875rem; color: #64748b;">请检查网络后，完全关闭并重启本程序。如果问题持续存在，您可能需要更换网络环境。</p>
    </div>
  </div>
<!-- 段落结束： cdn-error-overlay -->

<!-- 段落开始： loading-overlay -->
<div id="loading-overlay" class="absolute inset-0 z-50 flex flex-col items-center justify-center gap-6 bg-white/80">
    <div class="loader"></div>
    <p class="text-base font-bold text-sky-600">正在加载资源中...</p>
  </div>
<!-- 段落结束： loading-overlay -->
