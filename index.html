<!DOCTYPE html>
<html lang="zh-CN">

<head>

  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js" onerror="handleCdnError('Socket.IO')"></script>
  <meta charset="UTF-8">
  <title>跑步助手</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- 注意: Tailwind CDN 仅用于开发/演示。生产环境建议安装为 PostCSS 插件 -->
  <script src="https://cdn.tailwindcss.com" onerror="handleCdnError()"></script>

  <!-- Google Fonts 标准引入（替代手写 @font-face） -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Zilla+Slab:wght@600;700&family=Noto+Sans+SC:wght@400;600;700&display=swap"
    rel="stylesheet" onerror="handleCdnError()">

  <script src="https://webapi.amap.com/loader.js" onerror="handleCdnError()"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
  <script>
    // 配置TailwindCSS
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { 'sans': ['Noto Sans SC', 'system-ui', 'sans-serif'], 'display': ['Zilla Slab', 'serif'] },
          colors: { 'base': '#7dd3fc' }
        }
      }
    }
  </script>
  <style>
    /* CSS变量定义 */



    /* 默认主题（无需额外 class） */
    body {
      background: linear-gradient(180deg, rgba(245, 250, 255, 1) 0%, rgba(235, 245, 255, 1) 40%, rgba(250, 240, 255, 1) 100%);
      background-attachment: fixed;
    }

    .panel {
      backdrop-filter: blur(16px);
      background-color: var(--card-bg);
      border: 1px solid rgba(255, 255, 255, 0.45);
      box-shadow: 0 10px 24px rgba(16, 24, 40, 0.12);
    }

    /* 二次元主题 */
    body.theme-anime {
      /* 添加一张背景图，您可以替换为您喜欢的图片URL */
      background-image: url('https://api.paugram.com/wallpaper');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    body.theme-anime .panel {
      /* 面板使用更强烈的毛玻璃效果 */
      background-color: rgba(255, 255, 255, 0.65);
      /* 降低不透明度 */
      backdrop-filter: blur(20px) saturate(150%);
      /* 增强模糊和饱和度 */
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
    }

    /* 简约主题 */
    body.theme-minimalist {
      background: #f8f9fa;
      /* 使用纯色背景 */
    }

    body.theme-minimalist .panel {
      background-color: #ffffff;
      backdrop-filter: none;
      /* 移除毛玻璃效果 */
      border: 1px solid #e9ecef;
      /* 使用更柔和的边框 */
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      /* 使用更细微的阴影 */
      border-radius: 12px;
      /* 稍微减小圆角 */
    }

    /* 下拉选择框文本不换行，避免多行挤压导致“看起来不齐全” */
    #multi-config-user-select {
      white-space: nowrap;
      /* 文本不折行 */
      overflow-x: auto;
      /* 辅助：允许水平滚动（注意：部分浏览器不为 select 显示 H-scroll） */
      max-width: 100%;
      /* 约束为容器宽度，避免撑破布局 */
    }


    /* 仅针对 select 元素减小统一表单内边距，扩大可视空间 */
    select.select-field {
      padding: 0.45rem 0.6rem;
      /* 原来 .select-field 的 padding 比较厚，适当减小 */
    }

    /* 给 options 提示完整文本（不同浏览器对 option 的样式支持有限，tooltip 更稳妥） */
    #multi-config-user-select option {
      /* 大多数浏览器不支持 option 的 ellipsis，但可保留以尽可能兼容 */
      text-overflow: ellipsis;
      overflow: hidden;
    }

    /* 模态框背景 */

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: auto;
      /* 允许背景遮罩层交互，阻挡下方点击 */
      background-color: rgba(0, 0, 0, 0.4);
      /* 添加半透明黑色背景 */
      /* display 将由 JS 控制为 'flex' 以实现居中 */
      align-items: center;
      justify-content: center;
    }


    /* 内容容器：居中显示 */
    .modal-content {
      background: linear-gradient(135deg, #ffffff, #f7f9ff);
      /* margin: 10% auto;  <-- 移除此行以允许 Flexbox 垂直居中 */
      padding: 24px 28px;
      border-radius: 16px;
      width: 360px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25),
        0 0 12px rgba(120, 160, 255, 0.4);
      animation: fadeIn 0.35s ease, scaleIn 0.35s ease;
      font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
      position: relative;
      pointer-events: auto;
      /* 内容可交互 */
    }

    /* 标题 */
    .modal-content h3 {
      margin-top: 0;
      text-align: center;
      font-size: 20px;
      color: #3a4a7a;
      letter-spacing: 1px;
    }

    /* 关闭按钮 */
    .close {
      position: absolute;
      right: 14px;
      top: 10px;
      font-size: 22px;
      cursor: pointer;
      color: #888;
      transition: color 0.2s;
    }

    .close:hover {
      color: #ff5c8a;
    }

    /* 表单 */
    .form-group {
      margin: 14px 0;
    }

    .form-group label {
      display: inline-block;
      width: 70px;
      font-weight: bold;
      color: #4a4a6a;
    }

    .form-group input {
      width: 230px;
      padding: 8px 10px;
      border: 1px solid #ccd2f0;
      border-radius: 8px;
      outline: none;
      transition: all 0.25s;
      background: #fff;
    }

    .form-group input:focus {
      border-color: #7a9dff;
      box-shadow: 0 0 6px rgba(122, 157, 255, 0.6);
    }

    /* 底部按钮 */
    .modal-actions {
      text-align: right;
      margin-top: 18px;
    }

    .modal-actions button {
      margin-left: 10px;
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.25s;
    }

    #newUserCancel {
      background: #e0e4f7;
      color: #444;
    }

    #newUserCancel:hover {
      background: #d0d6f0;
    }

    #newUserConfirm {
      background: linear-gradient(135deg, #7a9dff, #5c7cff);
      color: #fff;
      box-shadow: 0 3px 8px rgba(92, 124, 255, 0.4);
    }

    #newUserConfirm:hover {
      background: linear-gradient(135deg, #5c7cff, #4a68e0);
      box-shadow: 0 4px 10px rgba(92, 124, 255, 0.55);
    }

    /* 动画 */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes scaleIn {
      from {
        transform: scale(0.9);
      }

      to {
        transform: scale(1);
      }
    }



    :root {
      --base-color: #7dd3fc;
      --base-color-600: #0891b2;
      --base-color-500: #22d3ee;
      --base-color-300: #a5f3fc;
      --card-bg: rgba(255, 255, 255, 0.85);
      --glass: rgba(255, 255, 255, 0.65);
      --ink: #0f172a;
    }

    html,
    body {
      height: 100%;
    }

    body {
      background: linear-gradient(180deg, rgba(245, 250, 255, 1) 0%, rgba(235, 245, 255, 1) 40%, rgba(250, 240, 255, 1) 100%);
      background-attachment: fixed;
    }

    .bg-anime {
      background-image: url('');
      background-size: cover;
      background-position: center;
    }

    .panel {
      backdrop-filter: blur(16px);
      background-color: var(--card-bg);
      border: 1px solid rgba(255, 255, 255, 0.45);
      box-shadow: 0 10px 24px rgba(16, 24, 40, 0.12);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
      padding: .65rem 1rem;
      border-radius: 999px;
      font-weight: 700;
      transition: all .25s ease;
      box-shadow: 0 6px 16px rgba(2, 132, 199, .15);
    }

    .btn:hover {
      /* transform: translateY(-1px); */
      /* 按钮没事不要瞎移动 */
      transform: none;
      box-shadow: 0 12px 28px rgba(2, 132, 199, .22);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-primary {
      color: #fff;
      background: linear-gradient(135deg, var(--base-color), var(--base-color-600));
    }

    .btn-secondary {
      color: #fff;
      background: linear-gradient(135deg, #a855f7, #7c3aed);
    }

    .btn-danger {
      color: #fff;
      background: linear-gradient(135deg, #ef4444, #b91c1c);
    }

    .btn-warning {
      color: #fff;
      background: linear-gradient(135deg, #f59e0b, #d97706);
    }

    .btn-success {
      color: #fff;
      background: linear-gradient(135deg, #10b981, #059669);
    }

    .btn-ghost {
      color: #334155;
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .input-field,
    .select-field {
      width: 100%;
      border-radius: 14px;
      padding: .7rem .9rem;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6), 0 8px 14px rgba(16, 24, 40, 0.06);
      color: #0f172a;
      transition: box-shadow .2s ease, border-color .2s ease;
    }

    .input-field:focus,
    .select-field:focus {
      outline: none;
      border-color: var(--base-color-600);
      box-shadow: 0 0 0 3px rgba(34, 211, 238, .25);
    }

    .badge {
      display: inline-block;
      padding: .25rem .6rem;
      border-radius: 999px;
      font-weight: 700;
      background: rgba(34, 211, 238, .18);
      color: var(--base-color-600);
    }

    .card-title {
      font-family: 'Zilla Slab', serif;
      letter-spacing: .5px;
    }

    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(226, 232, 240, 0.6);
    }

    ::-webkit-scrollbar-thumb {
      background-color: rgba(148, 163, 184, 0.8);
      border-radius: 6px;
      border: 2px solid rgba(226, 232, 240, 0.6);
    }

    ::-webkit-scrollbar-thumb:hover {
      background-color: rgba(100, 116, 139, 0.9);
    }

    .tab-button {
      padding: .5rem .75rem;
      font-weight: 700;
      color: #64748b;
      border-bottom: 3px solid transparent;
      transition: all .2s ease;
    }

    .tab-button.active {
      color: var(--base-color-600);
      border-bottom-color: var(--base-color-600);
    }

    #task-list>div.selected {
      background: rgba(34, 211, 238, .14);
      border-left: 4px solid var(--base-color-600);
    }

    #map-container.drawing .amap-marker,
    #map-container.drawing .amap-text,
    #map-container.drawing .amap-overlay-text,
    #map-container.drawing .amap-overlay {
      pointer-events: none !important;
    }

    .pulsing-marker {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(0.98);
        box-shadow: 0 0 0 0 rgba(2, 132, 199, 0.7);
      }

      70% {
        transform: scale(1);
        box-shadow: 0 0 0 12px rgba(2, 132, 199, 0);
      }

      100% {
        transform: scale(0.98);
        box-shadow: 0 0 0 0 rgba(2, 132, 199, 0);
      }
    }

    .hero-overlay {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.85) 60%);
    }

    .theme-dot {
      width: 20px;
      height: 20px;
      border-radius: 100%;
      border: 2px solid #fff;
      box-shadow: 0 4px 10px rgba(0, 0, 0, .15);
      cursor: pointer;
      transition: transform .2s ease;
    }

    .theme-dot:hover {
      transform: scale(1.05);
    }

    /* 模态框显示时，隐藏地图logo和版权 */
    #amap-key-modal:not(.hidden)~#map-container .amap-logo,
    #amap-key-modal:not(.hidden)~#map-container .amap-copyright,
    #amap-key-modal:not(.hidden)~main>#multi-map-container .amap-logo,
    #amap-key-modal:not(.hidden)~main>#multi-map-container .amap-copyright,

    #user-details-modal:not(.hidden)~#map-container .amap-logo,
    #user-details-modal:not(.hidden)~#map-container .amap-copyright,
    #task-details-modal:not(.hidden)~#map-container .amap-logo,
    #task-details-modal:not(.hidden)~#map-container .amap-copyright,
    #user-details-modal:not(.hidden)~main>#multi-map-container .amap-logo,
    #user-details-modal:not(.hidden)~main>#multi-map-container .amap-copyright,
    #task-details-modal:not(.hidden)~main>#multi-map-container .amap-logo,
    #task-details-modal:not(.hidden)~main>#multi-map-container .amap-copyright,
    #account-params-modal:not(.hidden)~main>#multi-map-container .amap-logo,
    #account-params-modal:not(.hidden)~main>#multi-map-container .amap-copyright {
      display: none !important;
    }

    /* 当任意模态打开时，隐藏地图的 logo 与版权 */
    body.modal-visible .amap-logo,
    body.modal-visible .amap-copyright {
      display: none !important;
    }

    #admin-modal-close-btn:hover {
      transform: translateY(-50%);
      /* 强制 hover 时只应用垂直居中 transform */
    }

    /* --- Bug Fix: 防止 SweetAlert2 弹窗导致页面位移 --- */
    body.swal2-shown:not(.swal2-toast-shown) {
      overflow: hidden !important;
      /* 强制保持 overflow: hidden */
      padding-right: 0 !important;
      /* 强制移除 SweetAlert 可能添加的 padding */
    }
  </style>

</head>

<body class="text-slate-800 font-sans h-screen overflow-hidden antialiased">

  <div id="cdn-error-overlay"
    class="fixed inset-0 z-9999 hidden flex-col items-center justify-center bg-[#f8fafc] p-8 text-center text-[#475569]"
    style="font-family: sans-serif;">
    <div style="max-width: 500px;">
      <h1 style="font-size: 1.875rem; font-weight: bold; color: #be123c; margin-bottom: 1rem;">界面资源加载失败</h1>
      <p style="font-size: 1.125rem; margin-bottom: 1.5rem;">应用程序无法连接到外部网络服务器（CDN）来下载必要的界面文件（如样式和地图库）。</p>
      <div
        style="background-color: #f1f5f9; border-radius: 0.5rem; padding: 1rem; text-align: left; font-size: 0.875rem; line-height: 1.5;">
        <h2 style="font-weight: 600; color: #1e293b; margin-top: 0; margin-bottom: 0.75rem;">可能的原因及解决方法：</h2>
        <ul style="list-style-type: disc; padding-left: 1.25rem; margin: 0;">
          <li style="margin-bottom: 0.5rem;"><strong>检查您的网络连接</strong>：请确保您的设备已连接到互联网。</li>
          <li style="margin-bottom: 0.5rem;"><strong>检查防火墙或代理</strong>：系统防火墙、杀毒软件或网络代理可能阻止了程序访问网络。</li>
          <li><strong>网络环境问题</strong>：您当前的网络环境可能无法稳定访问所需的外部资源。</li>
        </ul>
      </div>
      <p style="margin-top: 1.5rem; font-size: 0.875rem; color: #64748b;">请检查网络后，完全关闭并重启本程序。如果问题持续存在，您可能需要更换网络环境。</p>
    </div>
  </div>

  <!-- 新用户添加模态框 -->
  <div id="newUserModal" class="modal">
    <div class="modal-content">
      <span class="close" id="newUserClose">&times;</span>
      <h3>添加新用户</h3>
      <div class="form-group">
        <label for="newUsername">账号：</label>
        <input type="text" id="newUsername" placeholder="请输入账号">
      </div>
      <div class="form-group">
        <label for="newPassword">密码：</label>
        <input type="password" id="newPassword" placeholder="请输入密码">
      </div>
      <div class="modal-actions">
        <button id="newUserCancel">取消</button>
        <button id="newUserConfirm">确认</button>
      </div>
    </div>
  </div>


  <!-- 加载遮罩层 -->
  <div id="loading-overlay" class="absolute inset-0 z-50 flex flex-col items-center justify-center gap-6 bg-white/80">
    <div class="loader"></div>
    <p class="text-base font-bold text-sky-600">正在加载资源中...</p>
  </div>

  <!-- 用户认证登录界面 -->
    <!-- ========================================
     动态加载区域: auth-login-container
     原始大小: 4.8 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="auth-login-container-placeholder" data-fragment="auth-login-container">
    <!-- 此区域将通过 JavaScript 动态加载 -->
    <div class="loading-indicator" style="display: none; text-align: center; padding: 20px;">
      <p>正在加载 auth-login-container...</p>
    </div>
  </div>
  <script>
    // 动态加载 HTML 片段: auth-login-container
    (function() {
      const placeholder = document.getElementById('auth-login-container-placeholder');
      const fragmentName = 'auth-login-container';
      
      // 显示加载提示
      const loadingIndicator = placeholder.querySelector('.loading-indicator');
      if (loadingIndicator) loadingIndicator.style.display = 'block';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
          if (loadingIndicator) {
            loadingIndicator.innerHTML = '<p style="color: red;">加载失败，请刷新页面重试</p>';
          }
        });
    })();
  </script>

  <!-- 登录界面 -->
    <!-- ========================================
     动态加载区域: login-container
     原始大小: 4.4 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="login-container-placeholder" data-fragment="login-container">
    <!-- 此区域将通过 JavaScript 动态加载 -->
    <div class="loading-indicator" style="display: none; text-align: center; padding: 20px;">
      <p>正在加载 login-container...</p>
    </div>
  </div>
  <script>
    // 动态加载 HTML 片段: login-container
    (function() {
      const placeholder = document.getElementById('login-container-placeholder');
      const fragmentName = 'login-container';
      
      // 显示加载提示
      const loadingIndicator = placeholder.querySelector('.loading-indicator');
      if (loadingIndicator) loadingIndicator.style.display = 'block';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
          if (loadingIndicator) {
            loadingIndicator.innerHTML = '<p style="color: red;">加载失败，请刷新页面重试</p>';
          }
        });
    })();
  </script>

  <!-- 主应用界面 -->
    <!-- ========================================
     动态加载区域: main-app
     原始大小: 10.0 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="main-app-placeholder" data-fragment="main-app">
    <!-- 此区域将通过 JavaScript 动态加载 -->
    <div class="loading-indicator" style="display: none; text-align: center; padding: 20px;">
      <p>正在加载 main-app...</p>
    </div>
  </div>
  <script>
    // 动态加载 HTML 片段: main-app
    (function() {
      const placeholder = document.getElementById('main-app-placeholder');
      const fragmentName = 'main-app';
      
      // 显示加载提示
      const loadingIndicator = placeholder.querySelector('.loading-indicator');
      if (loadingIndicator) loadingIndicator.style.display = 'block';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
          if (loadingIndicator) {
            loadingIndicator.innerHTML = '<p style="color: red;">加载失败，请刷新页面重试</p>';
          }
        });
    })();
  </script>

    <!-- ========================================
     动态加载区域: multi-account-app
     原始大小: 6.1 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="multi-account-app-placeholder" data-fragment="multi-account-app">
    <!-- 此区域将通过 JavaScript 动态加载 -->
    <div class="loading-indicator" style="display: none; text-align: center; padding: 20px;">
      <p>正在加载 multi-account-app...</p>
    </div>
  </div>
  <script>
    // 动态加载 HTML 片段: multi-account-app
    (function() {
      const placeholder = document.getElementById('multi-account-app-placeholder');
      const fragmentName = 'multi-account-app';
      
      // 显示加载提示
      const loadingIndicator = placeholder.querySelector('.loading-indicator');
      if (loadingIndicator) loadingIndicator.style.display = 'block';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
          if (loadingIndicator) {
            loadingIndicator.innerHTML = '<p style="color: red;">加载失败，请刷新页面重试</p>';
          }
        });
    })();
  </script>

  <!-- 模态对话框 -->
    <!-- ========================================
     动态加载区域: amap-key-modal
     原始大小: 0.9 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="amap-key-modal-placeholder" data-fragment="amap-key-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: amap-key-modal
    (function() {
      const placeholder = document.getElementById('amap-key-modal-placeholder');
      const fragmentName = 'amap-key-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>







    <!-- ========================================
     动态加载区域: auto-gen-modal
     原始大小: 1.2 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="auto-gen-modal-placeholder" data-fragment="auto-gen-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: auto-gen-modal
    (function() {
      const placeholder = document.getElementById('auto-gen-modal-placeholder');
      const fragmentName = 'auto-gen-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>
    <!-- ========================================
     动态加载区域: user-details-modal
     原始大小: 0.7 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="user-details-modal-placeholder" data-fragment="user-details-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: user-details-modal
    (function() {
      const placeholder = document.getElementById('user-details-modal-placeholder');
      const fragmentName = 'user-details-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>
    <!-- ========================================
     动态加载区域: task-details-modal
     原始大小: 0.7 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="task-details-modal-placeholder" data-fragment="task-details-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: task-details-modal
    (function() {
      const placeholder = document.getElementById('task-details-modal-placeholder');
      const fragmentName = 'task-details-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>
    <!-- ========================================
     动态加载区域: account-params-modal
     原始大小: 1.0 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="account-params-modal-placeholder" data-fragment="account-params-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: account-params-modal
    (function() {
      const placeholder = document.getElementById('account-params-modal-placeholder');
      const fragmentName = 'account-params-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>

    <!-- ========================================
     动态加载区域: notifications-modal
     原始大小: 0.9 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="notifications-modal-placeholder" data-fragment="notifications-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: notifications-modal
    (function() {
      const placeholder = document.getElementById('notifications-modal-placeholder');
      const fragmentName = 'notifications-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>


    <!-- ========================================
     动态加载区域: alert-modal
     原始大小: 0.6 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="alert-modal-placeholder" data-fragment="alert-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: alert-modal
    (function() {
      const placeholder = document.getElementById('alert-modal-placeholder');
      const fragmentName = 'alert-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>

    <!-- ========================================
     动态加载区域: admin-panel-modal
     原始大小: 13.5 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="admin-panel-modal-placeholder" data-fragment="admin-panel-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
    <div class="loading-indicator" style="display: none; text-align: center; padding: 20px;">
      <p>正在加载 admin-panel-modal...</p>
    </div>
  </div>
  <script>
    // 动态加载 HTML 片段: admin-panel-modal
    (function() {
      const placeholder = document.getElementById('admin-panel-modal-placeholder');
      const fragmentName = 'admin-panel-modal';
      
      // 显示加载提示
      const loadingIndicator = placeholder.querySelector('.loading-indicator');
      if (loadingIndicator) loadingIndicator.style.display = 'block';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
          if (loadingIndicator) {
            loadingIndicator.innerHTML = '<p style="color: red;">加载失败，请刷新页面重试</p>';
          }
        });
    })();
  </script>

    <!-- ========================================
     动态加载区域: confirm-modal
     原始大小: 0.7 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="confirm-modal-placeholder" data-fragment="confirm-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: confirm-modal
    (function() {
      const placeholder = document.getElementById('confirm-modal-placeholder');
      const fragmentName = 'confirm-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>

  <!-- 会话选择模态框 -->
    <!-- ========================================
     动态加载区域: session-picker-modal
     原始大小: 1.9 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="session-picker-modal-placeholder" data-fragment="session-picker-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: session-picker-modal
    (function() {
      const placeholder = document.getElementById('session-picker-modal-placeholder');
      const fragmentName = 'session-picker-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>

  <!-- 创建权限组模态框 -->
    <!-- ========================================
     动态加载区域: create-group-modal
     原始大小: 1.7 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="create-group-modal-placeholder" data-fragment="create-group-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: create-group-modal
    (function() {
      const placeholder = document.getElementById('create-group-modal-placeholder');
      const fragmentName = 'create-group-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>

  <!-- 编辑权限组权限模态框 -->
    <!-- ========================================
     动态加载区域: edit-group-permissions-modal
     原始大小: 1.2 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="edit-group-permissions-modal-placeholder" data-fragment="edit-group-permissions-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: edit-group-permissions-modal
    (function() {
      const placeholder = document.getElementById('edit-group-permissions-modal-placeholder');
      const fragmentName = 'edit-group-permissions-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>

  <!-- 管理用户权限模态框 -->
    <!-- ========================================
     动态加载区域: manage-user-permissions-modal
     原始大小: 1.6 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="manage-user-permissions-modal-placeholder" data-fragment="manage-user-permissions-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: manage-user-permissions-modal
    (function() {
      const placeholder = document.getElementById('manage-user-permissions-modal-placeholder');
      const fragmentName = 'manage-user-permissions-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>

  <!-- 设置会话限制模态框 -->
    <!-- ========================================
     动态加载区域: set-max-sessions-modal
     原始大小: 1.2 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="set-max-sessions-modal-placeholder" data-fragment="set-max-sessions-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: set-max-sessions-modal
    (function() {
      const placeholder = document.getElementById('set-max-sessions-modal-placeholder');
      const fragmentName = 'set-max-sessions-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>

  <!-- 重置用户密码模态框 -->
    <!-- ========================================
     动态加载区域: reset-user-password-modal
     原始大小: 1.3 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="reset-user-password-modal-placeholder" data-fragment="reset-user-password-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: reset-user-password-modal
    (function() {
      const placeholder = document.getElementById('reset-user-password-modal-placeholder');
      const fragmentName = 'reset-user-password-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>

  <!-- 头像裁剪模态框 -->
    <!-- ========================================
     动态加载区域: avatar-crop-modal
     原始大小: 0.7 KB
     通过 API 动态加载以减小初始页面大小
     ======================================== -->
  <div id="avatar-crop-modal-placeholder" data-fragment="avatar-crop-modal">
    <!-- 此区域将通过 JavaScript 动态加载 -->
  </div>
  <script>
    // 动态加载 HTML 片段: avatar-crop-modal
    (function() {
      const placeholder = document.getElementById('avatar-crop-modal-placeholder');
      const fragmentName = 'avatar-crop-modal';
      
      // 从 API 加载 HTML 片段
      fetch(`/html/${fragmentName}.html`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return response.text();
        })
        .then(html => {
          // 将加载的 HTML 插入到占位符中
          placeholder.outerHTML = html;
          console.log(`[HTML加载] 成功加载片段: ${fragmentName}`);
        })
        .catch(error => {
          console.error(`[HTML加载] 加载片段失败: ${fragmentName}`, error);
        });
    })();
  </script>

  <script>
    // ==============================================================================
    // 动态加载 JavaScript 代码
    // ==============================================================================
    // 此脚本从后端 API 动态加载 JavaScript 代码，实现以下优势：
    // 1. 代码与 HTML 分离，便于维护和管理
    // 2. 浏览器可以缓存 JavaScript 文件，减少重复加载
    // 3. 修改 JavaScript 代码后无需修改 HTML 文件
    // 4. 支持按需加载特定函数（通过 /JavaScript/<function>.js 端点）
    //
    // API 端点：
    // - /JavaScript.js                --> 返回完整的 JavaScript 代码
    // - /JavaScript/<function>.js     --> 返回特定函数的代码（按需加载）
    //
    // 缓存机制：
    // - 浏览器会缓存加载的 JavaScript 文件（1小时）
    // - 使用 ETag 和 Last-Modified 支持条件请求
    // - 修改 JavaScript.js 后，浏览器会自动检测并重新加载
    // ==============================================================================

    (function() {
      // 创建 script 标签动态加载 JavaScript
      const script = document.createElement('script');
      
      // 设置脚本源为后端 API 端点
      script.src = '/JavaScript.js';
      
      // 设置字符编码为 UTF-8（确保中文注释正确显示）
      script.charset = 'utf-8';
      
      // 异步加载（不阻塞页面渲染）
      script.async = false;  // 保持执行顺序
      
      // 加载成功回调
      script.onload = function() {
        console.log('[JavaScript加载] 成功从 API 加载 JavaScript 代码');
        // 标记应用初始化完成（如果 appInitialized 变量已定义）
        if (typeof appInitialized !== 'undefined') {
          appInitialized = true;
        }
      };
      
      // 加载失败回调
      script.onerror = function() {
        console.error('[JavaScript加载] 从 API 加载 JavaScript 失败');
        // 可以在这里添加回退逻辑，例如显示错误提示
        alert('JavaScript 代码加载失败，请刷新页面重试');
      };
      
      // 将脚本标签添加到文档头部
      document.head.appendChild(script);
    })();
  </script>
</body>

</html>